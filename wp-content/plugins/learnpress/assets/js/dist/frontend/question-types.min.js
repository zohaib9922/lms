!function(){"use strict";var e={d:function(t,s){for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function s(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}e.r(t),e.d(t,{FillInBlanks:function(){return f},MultipleChoices:function(){return w},QuestionBase:function(){return u},SingleChoice:function(){return d},TrueOrFalse:function(){return m},default:function(){return g}});var n=window.wp.element,r=window.wp.compose,i=window.wp.data,o=window.wp.i18n;const{isArray:a,get:p,set:l}=lodash;class c extends n.Component{constructor(e){super(...arguments),s(this,"prepare",((e,t)=>{const{question:s}=e;return s&&s.id!==t.questionId?{options:t.self.parseOptions(s.options)}:null})),s(this,"setInputRef",((e,t)=>{this.inputs||(this.inputs={}),this.inputs[t]=e})),s(this,"maybeShowCorrectAnswer",(()=>{const{status:e,isCheckedAnswer:t,showCorrectReview:s,isReviewing:n}=this.props;return"completed"===e&&s||t&&!n})),s(this,"maybeDisabledOption",(e=>{const{answered:t,status:s,isCheckedAnswer:n}=this.props;return n||"started"!==s})),s(this,"setAnswerChecked",(()=>e=>{const{updateUserQuestionAnswers:t,question:s,status:n}=this.props;if("started"!==n)return(0,o.__)("LP Error: can not set answers","learnpress");const r=this.$wrap.find(".option-check"),i=[],a="multi_choice"!==s.type;r.each(((e,t)=>{if(t.checked&&(i.push(t.value),a))return!1})),t(s.id,a?i[0]:i)})),s(this,"maybeCheckedAnswer",(e=>{const{answered:t}=this.props;return a(t)?!!t.find((t=>t==e)):e==t})),s(this,"getOptionType",((e,t)=>{let s="radio";return"multi_choice"===e&&(s="checkbox"),s})),s(this,"isDefaultType",(()=>this.props.supportOptions)),s(this,"getWarningMessage",(()=>(0,n.createElement)(n.Fragment,null,(0,o.__)("Render function should be overwritten from base.","learnpress")))),s(this,"getOptionClass",(e=>{const{answered:t}=this.props;return["answer-option"]})),s(this,"parseOptions",(e=>(e&&(e=a(e)?e:JSON.parse(CryptoJS.AES.decrypt(e.data,e.key,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),e=a(e)?e:JSON.parse(e)),e||[]))),s(this,"getOptions",(()=>this.state.options||[])),s(this,"isCorrect",(()=>{const{answered:e}=this.props;if(!e)return!1;let t,s,n;for(t=0,n=this.getOptions();t<n.length;t++)if(s=n[t],"yes"===s.isTrue&&e==s.value)return!0;return!1})),s(this,"isChecked",(()=>{const{question:e}=this.props;return(0,i.select)("learnpress/quiz").isCheckedAnswer(e.id)})),s(this,"getCorrectLabel",(()=>{const{status:e,answered:t,question:s}=this.props,r=(LP.config.isQuestionCorrect[s.type]||this.isCorrect).call(this);return this.maybeShowCorrectAnswer()&&(0,n.createElement)("div",{className:"question-response"+(r?" correct":" incorrect")},(0,n.createElement)("span",{className:"label"},r?(0,o.__)("Correct","learnpress"):(0,o.__)("Incorrect","learnpress")),(0,n.createElement)("span",{className:"point"},sprintf((0,o.__)("%d/%d point","learnpress"),r?s.point:0,s.point)))}));const{question:t}=e;this.state={optionClass:["answer-option"],questionId:0,options:t?this.parseOptions(t.options):[],self:this},e.$wrap&&(this.$wrap=e.$wrap)}static getDerivedStateFromProps(e,t){return t.self.prepare(e,t)}componentDidMount(){const e=this.prepare(this.props,this.state);e&&this.setState(e)}render(){const{question:e,status:t}=this.props;return(0,n.createElement)("div",{className:"question-answers"},this.isDefaultType()&&(0,n.createElement)("ul",{id:`answer-options-${e.id}`,className:"answer-options"},this.getOptions().map((s=>{const r=`learn-press-answer-option-${s.uid}`;return(0,n.createElement)("li",{className:this.getOptionClass(s).join(" "),key:`answer-option-${s.uid}`},(0,n.createElement)("input",{type:this.getOptionType(e.type,s),className:"option-check",name:"started"===t?`learn-press-question-${e.id}`:"",id:r,ref:e=>{this.setInputRef(e,s.value)},onChange:this.setAnswerChecked(),disabled:this.maybeDisabledOption(s),checked:this.maybeCheckedAnswer(s.value),value:"started"===t?s.value:""}),(0,n.createElement)("label",{htmlFor:r,className:"option-title",dangerouslySetInnerHTML:{__html:s.title||s.value}}))}))),!this.isDefaultType()&&this.getWarningMessage(),this.getCorrectLabel())}}var u=c,d=class extends u{constructor(){super(...arguments),s(this,"getOptionClass",(e=>{const{answered:t}=this.props,s=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&s.push("answer-correct"),t&&("yes"===e.isTrue?t===e.value&&s.push("answered-correct"):t===e.value&&s.push("answered-wrong"))),s}))}};const{isBoolean:h}=lodash;var w=class extends u{constructor(){super(...arguments),s(this,"isCorrect",(()=>{const{answered:e}=this.props;if(h(e)||!e)return!1;let t,s,n;for(t=0,n=this.getOptions();t<n.length;t++)if(s=n[t],"yes"===s.isTrue){if(-1===e.indexOf(s.value))return!1}else if(-1!==e.indexOf(s.value))return!1;return!0})),s(this,"getOptionClass",(e=>{const{answered:t}=this.props,s=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&s.push("answer-correct"),t&&("yes"===e.isTrue?-1!==t.indexOf(e.value)&&s.push("answered-correct"):-1!==t.indexOf(e.value)&&s.push("answered-wrong"))),s}))}},m=class extends u{constructor(){super(...arguments),s(this,"getOptionClass",(e=>{const{answered:t}=this.props,s=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&s.push("answer-correct"),t&&("yes"===e.isTrue?t===e.value&&s.push("answered-correct"):t===e.value&&s.push("answered-wrong"))),s}))}},f=class extends u{constructor(){super(...arguments),s(this,"updateFibAnswer",(()=>{const e=document.querySelectorAll(".lp-fib-input > input"),{answered:t}=this.props,s=t||{};[...e].map((e=>{void 0===t&&(e.value=""),e.addEventListener("input",(t=>{this.setAnswered(s,e.dataset.id,t.target.value)})),e.addEventListener("paste",(t=>{this.setAnswered(s,e.dataset.id,t.target.value)}))}))})),s(this,"setAnswered",((e,t,s)=>{const{updateUserQuestionAnswers:n,question:r,status:i}=this.props;if("started"!==i)return"LP Error: can not set answers";const o=Object.assign(e,{[t]:s});n(r.id,o)})),s(this,"getCorrectLabel",(()=>{const{question:e,mark:t}=this.props;let s=t||0;return t&&(Number.isInteger(t)||(s=t.toFixed(2))),this.maybeShowCorrectAnswer()&&(0,n.createElement)("div",{className:"question-response correct"},(0,n.createElement)("span",{className:"label"},(0,o.__)("Points","learnpress")),(0,n.createElement)("span",{className:"point"},`${s}/${e.point} ${(0,o.__)("point","learnpress")}`),(0,n.createElement)("span",{className:"lp-fib-note"},(0,n.createElement)("span",{style:{background:"#00adff"}}),(0,o.__)("Correct","learnpress")),(0,n.createElement)("span",{className:"lp-fib-note"},(0,n.createElement)("span",{style:{background:"#d85554"}}),(0,o.__)("Incorrect","learnpress")))})),s(this,"convertInputField",(e=>{const{answered:t,isReviewing:s,showCorrectReview:n,isCheckedAnswer:r}=this.props;let i=e.title;const o=null==e?void 0:e.answers;return e.ids.map(((e,a)=>{const p="{{FIB_"+e+"}}";let l="";const c=o?null==o?void 0:o[e]:void 0;var u,d;c||s?(l+=`<span class="lp-fib-answered ${(n||r)&&null!=c&&c.correct?null!=c&&c.isCorrect?"correct":"fail":""}">`,null!=c&&c.isCorrect||(l+=`<span class="lp-fib-answered__answer">${null!==(d=null==t?void 0:t[e])&&void 0!==d?d:""}</span>`),null!=c&&c.isCorrect||null==c||!c.correct||(l+=" â†’ "),l+=`<span class="lp-fib-answered__fill">${null!==(u=null==c?void 0:c.correct)&&void 0!==u?u:""}</span>`,l+="</span>"):(l+='<div class="lp-fib-input" style="display: inline-block; width: auto;">',l+='<input type="text" data-id="'+e+'" value="" />',l+="</div>");i=i.replace(p,l)})),i}))}componentDidMount(){const{answered:e}=this.props;e&&[...document.querySelectorAll(".lp-fib-input > input")].map((t=>{e[t.dataset.id]&&(t.value=e[t.dataset.id])})),this.updateFibAnswer()}componentDidUpdate(e){e.answered||this.updateFibAnswer()}render(){return(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{className:"lp-fib-content"},this.getOptions().map((e=>(0,n.createElement)("div",{key:`blank-${e.uid}`,dangerouslySetInnerHTML:{__html:this.convertInputField(e)||e.value}})))),!this.isDefaultType()&&this.getWarningMessage(),this.getCorrectLabel())}};class y extends n.Component{constructor(){super(...arguments),s(this,"getQuestion",(()=>{const{question:e}=this.props;return LP.Hook.applyFilters("question-types",{single_choice:LP.questionTypes.SingleChoice,multi_choice:LP.questionTypes.MultipleChoices,true_or_false:LP.questionTypes.TrueOrFalse,fill_in_blanks:LP.questionTypes.FillInBlanks})[e.type]}))}render(){const{question:e,supportOptions:t}=this.props,s={...this.props};s.supportOptions=-1!==t.indexOf(e.type);const r=this.getQuestion()||function(){return(0,n.createElement)("div",{className:"question-types",dangerouslySetInnerHTML:{__html:(0,o.sprintf)((0,o.__)("Question <code>%s</code> invalid!","learnpress"),e.type)}})};return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(r,s))}}var g=(0,r.compose)((0,i.withSelect)(((e,t)=>{let{question:{id:s}}=t;const{getData:n,isCheckedAnswer:r}=e("learnpress/quiz");return{supportOptions:n("supportOptions"),isCheckedAnswer:r(s),keyPressed:n("keyPressed"),showCorrectReview:n("showCorrectReview"),isReviewing:"reviewing"===n("mode")}})),(0,i.withDispatch)((()=>({}))))(y);(window.LP=window.LP||{}).questionTypes=t}();